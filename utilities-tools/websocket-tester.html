<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WebSocket Request Tester</title>
  <style>
    :root {
      --bg: #f4f1ea;
      --card: #fffdf8;
      --ink: #1f2937;
      --muted: #6b7280;
      --accent: #0f766e;
      --accent-2: #155e75;
      --danger: #b91c1c;
      --border: #d6d3d1;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "IBM Plex Sans", "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at 20% 10%, #e6fffa 0, transparent 30%),
        radial-gradient(circle at 90% 80%, #e0f2fe 0, transparent 35%),
        var(--bg);
      color: var(--ink);
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 1rem;
    }

    .app {
      width: min(920px, 100%);
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 1rem;
      box-shadow: 0 14px 32px rgba(15, 23, 42, 0.08);
    }

    h1 {
      margin: 0 0 0.75rem;
      font-size: 1.35rem;
      letter-spacing: 0.2px;
    }

    .row {
      display: grid;
      gap: 0.6rem;
      margin-bottom: 0.8rem;
    }

    .row.two {
      grid-template-columns: 1fr auto auto;
    }

    @media (max-width: 760px) {
      .row.two {
        grid-template-columns: 1fr;
      }
    }

    label {
      font-size: 0.82rem;
      color: var(--muted);
    }

    input, textarea, button {
      font: inherit;
    }

    input, textarea {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 0.6rem 0.75rem;
      background: #fff;
      color: var(--ink);
    }

    textarea {
      min-height: 130px;
      resize: vertical;
    }

    .btn {
      border: 0;
      border-radius: 10px;
      padding: 0.65rem 0.9rem;
      cursor: pointer;
      color: #fff;
      background: var(--accent);
      min-width: 105px;
    }

    .btn:hover { background: var(--accent-2); }
    .btn.secondary { background: #374151; }
    .btn.secondary:hover { background: #111827; }
    .btn.danger { background: var(--danger); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }

    .status {
      margin: 0.35rem 0 0.7rem;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .log {
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #111827;
      color: #d1fae5;
      min-height: 240px;
      max-height: 360px;
      overflow: auto;
      padding: 0.75rem;
      font-family: "Fira Code", "JetBrains Mono", monospace;
      font-size: 0.84rem;
      line-height: 1.35;
      white-space: pre-wrap;
      word-break: break-word;
    }
  </style>
</head>
<body>
  <main class="app">
    <h1>WebSocket Request Tester</h1>

    <div class="row two">
      <div>
        <label for="wsUrl">WebSocket URL (`ws://` or `wss://`)</label>
        <input id="wsUrl" type="text" placeholder="wss://echo.websocket.events" value="wss://echo.websocket.events" />
      </div>
      <button id="connectBtn" class="btn">Connect</button>
      <button id="disconnectBtn" class="btn danger" disabled>Disconnect</button>
    </div>

    <p id="status" class="status">Status: Disconnected</p>

    <div class="row">
      <label for="payload">Payload to send</label>
      <textarea id="payload" placeholder='{"type":"ping","message":"hello"}'></textarea>
    </div>

    <div class="row two">
      <div>
        <label for="messageType">Payload type</label>
        <input id="messageType" type="text" value="text" readonly />
      </div>
      <button id="sendBtn" class="btn secondary" disabled>Send</button>
      <button id="clearBtn" class="btn secondary">Clear Log</button>
    </div>

    <div id="log" class="log"></div>
  </main>

  <script>
    const wsUrl = document.getElementById('wsUrl');
    const connectBtn = document.getElementById('connectBtn');
    const disconnectBtn = document.getElementById('disconnectBtn');
    const sendBtn = document.getElementById('sendBtn');
    const clearBtn = document.getElementById('clearBtn');
    const payload = document.getElementById('payload');
    const statusEl = document.getElementById('status');
    const logEl = document.getElementById('log');

    let socket = null;

    function stamp() {
      return new Date().toISOString();
    }

    function setStatus(text) {
      statusEl.textContent = `Status: ${text}`;
    }

    function appendLog(direction, message) {
      const line = `[${stamp()}] ${direction} ${message}\n`;
      logEl.textContent += line;
      logEl.scrollTop = logEl.scrollHeight;
    }

    function updateButtons() {
      const open = socket && socket.readyState === WebSocket.OPEN;
      connectBtn.disabled = open;
      disconnectBtn.disabled = !socket || socket.readyState === WebSocket.CLOSED;
      sendBtn.disabled = !open;
    }

    connectBtn.addEventListener('click', () => {
      const url = wsUrl.value.trim();
      if (!url) {
        appendLog('[ERROR]', 'Please provide a WebSocket URL.');
        return;
      }

      try {
        socket = new WebSocket(url);
      } catch (err) {
        appendLog('[ERROR]', `Cannot create socket: ${err.message}`);
        return;
      }

      setStatus('Connecting...');
      updateButtons();
      appendLog('[INFO]', `Connecting to ${url}`);

      socket.addEventListener('open', () => {
        setStatus(`Connected to ${url}`);
        appendLog('[OPEN ]', 'Connection established');
        updateButtons();
      });

      socket.addEventListener('message', (event) => {
        appendLog('[RECV ]', String(event.data));
      });

      socket.addEventListener('error', () => {
        appendLog('[ERROR]', 'WebSocket error occurred');
      });

      socket.addEventListener('close', (event) => {
        setStatus(`Disconnected (code=${event.code}, reason=${event.reason || 'n/a'})`);
        appendLog('[CLOSE]', `Connection closed (code=${event.code}, reason=${event.reason || 'n/a'})`);
        updateButtons();
      });
    });

    disconnectBtn.addEventListener('click', () => {
      if (!socket) return;
      appendLog('[INFO ]', 'Closing connection...');
      socket.close(1000, 'Client disconnect');
    });

    sendBtn.addEventListener('click', () => {
      const body = payload.value;
      if (!socket || socket.readyState !== WebSocket.OPEN) {
        appendLog('[ERROR]', 'Socket is not open.');
        return;
      }
      socket.send(body);
      appendLog('[SEND ]', body || '(empty message)');
    });

    clearBtn.addEventListener('click', () => {
      logEl.textContent = '';
    });

    updateButtons();
    setStatus('Disconnected');
  </script>
</body>
</html>
